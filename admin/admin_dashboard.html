<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <!-- CDN for xlsx -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Sarabun', 'sans-serif'],
                    },
                    colors: {
                        primary: '#1E88E5', // Blue (Main Theme)
                        secondary: '#E91E63', // Pink (Interaction/Accent)
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-blue-50 font-sans p-6 min-h-screen">

    <div class="max-w-7xl mx-auto">
        <div class="flex justify-between items-center mb-8 bg-white p-6 rounded-xl shadow-md border-l-8 border-primary">
            <div>
                <h2 id="admin-name" class="text-2xl font-bold text-gray-800">Welcome, Admin</h2>
                <p class="text-sm text-gray-500">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏™‡∏≠‡∏ö</p>
            </div>
            <button id="logout-btn"
                class="bg-red-50 text-red-600 hover:bg-red-100 px-4 py-2 rounded-lg font-medium transition duration-200 border border-red-200">Logout</button>
        </div>

        <!-- Score Display Settings Panel -->
        <div
            class="bg-white p-5 rounded-xl shadow-md mb-6 border-l-8 border-blue-400 flex flex-wrap items-start gap-4 justify-between">
            <div>
                <h3 class="text-base font-bold text-blue-700 flex items-center gap-2">üìä ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h3>
                <p class="text-xs text-gray-500 mt-0.5">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏î‡∏¥‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå</p>
            </div>
            <div class="flex flex-col gap-4 flex-1 min-w-[280px]">
                <!-- Raw vs Percentage -->
                <div class="flex flex-col gap-1">
                    <label class="text-xs font-bold text-gray-600 uppercase tracking-wide">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</label>
                    <div class="flex items-center gap-4 flex-wrap">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="radio" name="score-display-mode" id="score-mode-raw" value="raw"
                                class="accent-blue-600 w-4 h-4">
                            <span class="text-sm font-medium text-gray-700">üî¢ ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏î‡∏¥‡∏ö</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="radio" name="score-display-mode" id="score-mode-percent" value="percent"
                                class="accent-blue-600 w-4 h-4">
                            <span class="text-sm font-medium text-gray-700">% ‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ (‡∏´‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß)</span>
                        </label>
                    </div>
                </div>
                <!-- Oral Exam -->
                <div class="flex flex-col gap-1">
                    <label class="text-xs font-bold text-gray-600 uppercase tracking-wide">‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå</label>
                    <div class="flex items-center gap-4 flex-wrap">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="radio" name="oral-exam-mode" id="oral-no" value="no"
                                class="accent-blue-600 w-4 h-4">
                            <span class="text-sm font-medium text-gray-700">‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="radio" name="oral-exam-mode" id="oral-not-included" value="not_included"
                                class="accent-blue-600 w-4 h-4">
                            <span class="text-sm font-medium text-gray-700">‚è≥ ‡∏°‡∏µ‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="radio" name="oral-exam-mode" id="oral-included" value="included"
                                class="accent-blue-600 w-4 h-4">
                            <span class="text-sm font-medium text-gray-700">‚úÖ ‡∏°‡∏µ‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå (‡∏£‡∏ß‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡πâ‡∏ß)</span>
                        </label>
                    </div>
                </div>
                <!-- Pre-Oral Threshold (shown only when not_included is selected) -->
                <div id="pre-oral-threshold-row"
                    class="hidden flex-col gap-1 p-3 bg-amber-50 rounded-lg border border-amber-200">
                    <label class="text-xs font-bold text-amber-700 uppercase tracking-wide">üéØ
                        ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏≠‡∏ö‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå</label>
                    <p class="text-xs text-amber-600">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå ‡πÄ‡∏ä‡πà‡∏ô <strong>95%</strong>
                        ‡∏´‡∏£‡∏∑‡∏≠ <strong>142.5 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</strong></p>
                    <div class="flex items-center gap-2 mt-1 flex-wrap">
                        <input type="number" id="pre-oral-threshold" min="0" step="0.01" placeholder="‡πÄ‡∏ä‡πà‡∏ô 95"
                            class="w-28 px-3 py-2 border-2 border-amber-300 rounded-lg text-center text-base font-bold focus:outline-none focus:ring-2 focus:ring-amber-400 bg-white">
                        <div class="flex flex-col gap-1">
                            <label class="flex items-center gap-2 cursor-pointer text-sm">
                                <input type="radio" name="pre-oral-unit" id="pre-oral-unit-pct" value="percent"
                                    class="accent-amber-600 w-4 h-4" checked>
                                <span class="font-medium text-amber-800">% ‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer text-sm">
                                <input type="radio" name="pre-oral-unit" id="pre-oral-unit-score" value="score"
                                    class="accent-amber-600 w-4 h-4">
                                <span class="font-medium text-amber-800">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏î‡∏¥‡∏ö</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <button id="save-display-settings-btn"
                        class="bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold px-4 py-2 rounded-lg transition duration-200 shadow-sm">
                        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                    </button>
                    <span id="display-settings-status" class="text-xs text-gray-500"></span>
                </div>
            </div>
        </div>

        <!-- Login Mode Setting Panel -->
        <div
            class="bg-white p-5 rounded-xl shadow-md mb-6 border-l-8 border-purple-400 flex flex-wrap items-center gap-4 justify-between">
            <div>
                <h3 class="text-base font-bold text-purple-700 flex items-center gap-2">üîê ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                </h3>
                <p class="text-xs text-gray-500 mt-0.5">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏∞ login ‡∏î‡πâ‡∏ß‡∏¢‡∏≠‡∏∞‡πÑ‡∏£ ‚Äî ‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Login ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
            </div>
            <div class="flex items-center gap-3 flex-wrap">
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="radio" name="login-mode" id="login-mode-thID" value="thID"
                        class="accent-purple-600 w-4 h-4">
                    <span class="text-sm font-medium text-gray-700">ü™™ ‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="radio" name="login-mode" id="login-mode-studentID" value="studentID"
                        class="accent-purple-600 w-4 h-4">
                    <span class="text-sm font-medium text-gray-700">üé´ ‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≠‡∏ö</span>
                </label>
                <button id="save-login-mode-btn"
                    class="bg-purple-600 hover:bg-purple-700 text-white text-sm font-semibold px-4 py-2 rounded-lg transition duration-200 shadow-sm">
                    ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                </button>
                <span id="login-mode-status" class="text-xs text-gray-500"></span>
            </div>
        </div>

        <!-- Per-Plan Score Config Panel -->
        <div class="bg-white p-5 rounded-xl shadow-md mb-6 border-l-8 border-orange-400">
            <div class="flex items-center justify-between mb-4 flex-wrap gap-2">
                <div>
                    <h3 class="text-base font-bold text-orange-700 flex items-center gap-2">üìä
                        ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô
                    </h3>
                    <p class="text-xs text-gray-500 mt-0.5">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡∏¥‡∏ä‡∏≤‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‚Äî
                        ‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</p>
                </div>
                <div class="flex items-center gap-2">
                    <button id="save-plan-config-btn"
                        class="bg-orange-500 hover:bg-orange-600 text-white text-sm font-semibold px-4 py-2 rounded-lg transition duration-200 shadow-sm">
                        üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                    </button>
                    <span id="plan-config-status" class="text-xs text-gray-500"></span>
                </div>
            </div>

            <!-- Plan Tabs -->
            <div class="flex gap-1 mb-4 border-b border-orange-200 flex-wrap" id="plan-config-tabs"></div>

            <!-- Tab Panels -->
            <div id="plan-config-panels"></div>
        </div>


        <!-- Form to add new student -->
        <div class="bg-white p-6 rounded-xl shadow-md mb-8 border-t-4 border-primary">
            <h3 class="text-lg font-bold text-primary mb-4 border-b pb-2">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà</h3>
            <form id="add-student-form">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</label>
                        <input type="text" name="thID" required maxlength="13"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent transition">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</label>
                        <select name="prefix"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent transition">
                            <option value="‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢">‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢</option>
                            <option value="‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á">‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á</option>
                            <option value="‡∏ô‡∏≤‡∏¢">‡∏ô‡∏≤‡∏¢</option>
                            <option value="‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß">‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠</label>
                        <input type="text" name="name" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent transition">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                        <input type="text" name="surname" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent transition">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≠‡∏ö</label>
                        <input type="text" name="studentID" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent transition">
                    </div>
                    <div class="lg:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                        <select name="study_plan" id="study-plan"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent transition">
                            <option value="ISMT">‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ (ISMT)</option>
                            <option value="ILEC">‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏†‡∏≤‡∏©‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏® (‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©-‡∏à‡∏µ‡∏ô) (ILEC)</option>
                            <option value="IDGT">‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏• (IDGT)</option>
                        </select>
                    </div>
                </div>

                <!-- Score fields ‚Äî rendered dynamically by JS based on plan config -->
                <div id="score-fields-container"
                    class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-6 bg-blue-50 p-4 rounded-lg border border-blue-100 min-h-[60px]">
                    <!-- Populated by renderAddFormScoreFields() in dashboard.js -->
                </div>

                <input type="submit" value="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô"
                    class="bg-secondary hover:bg-pink-600 text-white font-bold py-2 px-6 rounded-lg cursor-pointer transition duration-200 shadow-md">
            </form>
        </div>

        <!-- Excel upload button and status -->
        <div
            class="mb-6 flex flex-wrap gap-4 items-center bg-white p-4 rounded-xl shadow-md border-l-4 border-green-500">
            <div class="flex items-center gap-3 flex-wrap">
                <button id="upload-excel-btn"
                    class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition duration-200 flex items-center gap-2 shadow-sm">
                    <span>üìÑ</span> ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå Excel
                </button>
                <button id="download-template-btn"
                    class="bg-blue-50 hover:bg-blue-100 text-blue-700 font-medium py-2 px-4 rounded-lg transition duration-200 flex items-center gap-2 shadow-sm border border-blue-200">
                    <span>‚¨áÔ∏è</span> ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Template
                </button>
                <input type="file" id="excel-file" accept=".xlsx" style="display: none;">
            </div>
            <div id="upload-status" class="text-sm text-gray-600 w-full md:w-auto"></div>
        </div>

        <!-- Column Mapping Modal -->
        <div id="column-mapping-modal"
            class="fixed inset-0 z-50 hidden items-center justify-center bg-black/50 backdrop-blur-sm">
            <div
                class="bg-white rounded-2xl shadow-2xl w-11/12 max-w-3xl max-h-[90vh] overflow-y-auto mx-auto animate-in">
                <!-- Modal Header -->
                <div
                    class="sticky top-0 bg-gradient-to-r from-green-600 to-green-500 text-white px-6 py-4 rounded-t-2xl flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-bold">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î</h3>
                        <p class="text-sm text-green-100">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå (A-Z) ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå Excel ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                    </div>
                    <button id="mapping-modal-close"
                        class="text-white/80 hover:text-white text-2xl font-bold leading-none">&times;</button>
                </div>

                <!-- Modal Body -->
                <div class="p-6">
                    <!-- Start Row -->
                    <div class="mb-6 p-4 bg-amber-50 rounded-xl border border-amber-200">
                        <label class="block text-sm font-bold text-amber-800 mb-2">üìå ‡πÅ‡∏ñ‡∏ß‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                            (‡∏Ç‡πâ‡∏≤‡∏°‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á)</label>
                        <div class="flex items-center gap-3">
                            <input type="number" id="map-start-row" value="2" min="1" max="1000"
                                class="w-24 px-3 py-2 border-2 border-amber-300 rounded-lg text-center text-lg font-bold focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-transparent transition">
                            <span class="text-sm text-amber-700">‡πÉ‡∏™‡πà‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å‡∏≠‡∏¢‡∏π‡πà ‡πÄ‡∏ä‡πà‡∏ô
                                ‡∏ñ‡πâ‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏ñ‡∏ß <strong>8</strong> ‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà <strong>8</strong></span>
                        </div>
                    </div>

                    <!-- Column Mapping Fields -->
                    <div class="mb-4">
                        <h4 class="text-sm font-bold text-gray-700 mb-3 border-b pb-2">üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</h4>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                            <div class="flex flex-col">
                                <label class="text-xs font-medium text-gray-600 mb-1">‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</label>
                                <select id="map-thID"
                                    class="col-map-select px-3 py-2 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-green-400 focus:border-transparent transition text-sm font-mono"></select>
                            </div>
                            <div class="flex flex-col">
                                <label class="text-xs font-medium text-gray-600 mb-1">‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≠‡∏ö</label>
                                <select id="map-studentID"
                                    class="col-map-select px-3 py-2 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-green-400 focus:border-transparent transition text-sm font-mono"></select>
                            </div>
                            <div class="flex flex-col">
                                <label class="text-xs font-medium text-gray-600 mb-1">‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</label>
                                <select id="map-prefix"
                                    class="col-map-select px-3 py-2 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-green-400 focus:border-transparent transition text-sm font-mono"></select>
                            </div>
                            <div class="flex flex-col">
                                <label class="text-xs font-medium text-gray-600 mb-1" id="name-col-label">‡∏ä‡∏∑‡πà‡∏≠</label>
                                <select id="map-name"
                                    class="col-map-select px-3 py-2 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-green-400 focus:border-transparent transition text-sm font-mono"></select>
                            </div>
                            <div class="flex flex-col" id="surname-col-wrapper">
                                <label class="text-xs font-medium text-gray-600 mb-1">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                                <select id="map-surname"
                                    class="col-map-select px-3 py-2 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-green-400 focus:border-transparent transition text-sm font-mono"></select>
                            </div>
                            <div class="flex flex-col">
                                <label class="text-xs font-medium text-gray-600 mb-1">‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                                <select id="map-studyPlan"
                                    class="col-map-select px-3 py-2 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-green-400 focus:border-transparent transition text-sm font-mono"></select>
                            </div>
                        </div>
                        <!-- Split name option -->
                        <label class="mt-3 flex items-center gap-2 cursor-pointer w-fit">
                            <input type="checkbox" id="split-name-checkbox" class="accent-green-600 w-4 h-4">
                            <span class="text-xs text-gray-600">‚úÇÔ∏è ‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‚Äî ‡πÅ‡∏¢‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ
                                <span class="text-gray-400">(‡∏Ñ‡∏≥‡πÅ‡∏£‡∏Å = ‡∏ä‡∏∑‡πà‡∏≠, ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ = ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•)</span></span>
                        </label>
                    </div>

                    <div class="mb-6">
                        <h4 class="text-sm font-bold text-gray-700 mb-3 border-b pb-2">üìä ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3" id="mapping-score-columns">
                            <!-- Populated dynamically by JS based on plan config -->
                        </div>
                        <!-- Average score column (static, separate from dynamic subject cols) -->
                        <div class="mt-3 p-3 bg-teal-50 rounded-xl border border-teal-200">
                            <h5 class="text-xs font-bold text-teal-700 mb-2">üèÖ ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á)</h5>
                            <div class="flex flex-col w-40">
                                <label class="text-xs font-medium text-teal-700 mb-1">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</label>
                                <select id="map-avgScore"
                                    class="col-map-select px-3 py-2 border border-teal-300 rounded-lg bg-teal-50 focus:outline-none focus:ring-2 focus:ring-teal-400 focus:border-transparent transition text-sm font-mono"></select>
                            </div>
                        </div>
                    </div>

                    <!-- Preview summary -->
                    <div id="mapping-preview"
                        class="p-4 bg-gray-50 rounded-xl border border-gray-200 text-xs text-gray-600 mb-4">
                        <p class="font-bold mb-2 text-gray-700">üìù ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤:</p>
                        <div id="mapping-preview-content" class="font-mono"></div>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="sticky bottom-0 bg-gray-50 px-6 py-4 rounded-b-2xl flex justify-end gap-3 border-t">
                    <button id="mapping-cancel-btn"
                        class="px-5 py-2 rounded-lg border border-gray-300 text-gray-600 hover:bg-gray-100 font-medium transition duration-200">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                    <button id="mapping-confirm-btn"
                        class="px-5 py-2 rounded-lg bg-green-600 hover:bg-green-700 text-white font-bold transition duration-200 shadow-md flex items-center gap-2">
                        <span>‚úÖ</span> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå
                    </button>
                </div>
            </div>
        </div>

        <!-- Study plan statistics -->
        <div class="bg-white p-6 rounded-xl shadow-md mb-8 border-t-4 border-primary">
            <h3 class="text-lg font-bold text-primary mb-4 border-b pb-2">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏¢‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
            <div id="plan-stats-content" class="grid grid-cols-1 lg:grid-cols-2 gap-4"></div>
        </div>

        <!-- Search and table -->
        <div class="bg-white p-6 rounded-xl shadow-md">
            <div class="flex gap-2 mb-4 flex-wrap">
                <input type="text" id="search-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô..."
                    class="flex-1 min-w-48 px-4 py-2 border border-blue-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent transition">
                <button id="search-btn"
                    class="bg-secondary hover:bg-pink-700 text-white font-medium py-2 px-6 rounded-lg transition duration-200 shadow-sm">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
                <button id="delete-all-btn"
                    class="bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-lg transition duration-200 shadow-sm flex items-center gap-1">
                    üóëÔ∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
            </div>

            <div class="overflow-x-auto rounded-lg border border-gray-100">
                <table class="min-w-full text-sm">
                    <thead id="table-head">
                        <tr id="table-head-row" class="bg-blue-50 text-gray-700 uppercase text-xs leading-normal">
                            <th class="py-3 px-4 text-left font-bold border-b-2 border-primary">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                            <th class="py-3 px-4 text-left font-bold border-b-2 border-primary sortable cursor-pointer select-none"
                                data-sort="thID">‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô <span class="sort-icon">‚áÖ</span></th>
                            <th class="py-3 px-4 text-left font-bold border-b-2 border-primary sortable cursor-pointer select-none"
                                data-sort="studentID">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô <span class="sort-icon">‚áÖ</span></th>
                            <th class="py-3 px-4 text-left font-bold border-b-2 border-primary">‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</th>
                            <th class="py-3 px-4 text-left font-bold border-b-2 border-primary sortable cursor-pointer select-none"
                                data-sort="name">‡∏ä‡∏∑‡πà‡∏≠ <span class="sort-icon">‚áÖ</span></th>
                            <th class="py-3 px-4 text-left font-bold border-b-2 border-primary sortable cursor-pointer select-none"
                                data-sort="surname">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• <span class="sort-icon">‚áÖ</span></th>
                            <th class="py-3 px-4 text-left font-bold border-b-2 border-primary sortable cursor-pointer select-none"
                                data-sort="studyPlan">‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô <span class="sort-icon">‚áÖ</span></th>
                            <!-- Score headers rendered by JS from planConfig -->
                            <th id="table-score-headers"
                                class="py-3 px-4 text-center font-bold border-b-2 border-secondary" colspan="1"></th>
                            <th class="py-3 px-4 text-center font-bold border-b-2 border-pink-400 bg-pink-50 sortable cursor-pointer select-none"
                                data-sort="total">‡∏£‡∏ß‡∏° <span class="sort-icon">‚áÖ</span></th>
                            <th class="py-3 px-4 text-center font-bold border-b-2 border-teal-400 bg-teal-50 sortable cursor-pointer select-none"
                                data-sort="avgScore">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ <span class="sort-icon">‚áÖ</span></th>
                            <th class="py-3 px-4 text-left border-b-2 border-gray-300">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="student-table"
                        class="text-gray-700 text-sm font-light [&>tr]:border-b [&>tr]:border-gray-200 [&>tr:hover]:bg-blue-50 [&>tr>td]:py-3 [&>tr>td]:px-4 [&>tr>td]:whitespace-nowrap">
                        <!-- Data will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <footer class="mt-8 text-center text-gray-400 text-sm pb-8">
        <p>¬© 2026 Triamudom suksanomklao Nokronratchsima Powered by Intensive Digital Technology : IDGT</p>
    </footer>

    <!-- Load Firebase and Dashboard scripts -->
    <script type="module" src="./firebase.js"></script>
    <script type="module" src="./dashboard.js"></script>

</body>

</html>